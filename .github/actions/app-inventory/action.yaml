---
# yaml-language-server: $schema=https://json.schemastore.org/github-action.json
name: Application Inventory
description: Return a JSON array of app names from the apps directory

outputs:
  apps:
    description: Application Inventory
    value: ${{ steps.inventory.outputs.apps }}

runs:
  using: composite
  steps:
    - name: Application Inventory
      uses: actions/github-script@ed597411d8f924073f98dfc5c65a23a2325f34cd # v8.0.0
      id: inventory
      with:
        script: |
          const fs = require('fs');
          const path = require('path');

          function scanDirectory(path) {
              try {
                  const entries = fs.readdirSync(path, { withFileTypes: true });
                  const folderNames = entries
                      .filter((entry) => entry.isDirectory())
                      .map((entry) => entry.name);
                  return folderNames;
              } catch (error) {
                  core.setFailed(`Error reading directory ${path}: ${error.message}`);
                  return [];
              }
          }

          const appsDirectory = path.resolve(process.cwd(), 'apps');
          const apps = scanDirectory(appsDirectory).sort();
          core.setOutput('apps', JSON.stringify(apps));
